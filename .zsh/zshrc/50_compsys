#
# Completion
#

zmodload -i zsh/complist
autoload -Uz compinit
compinit -C

### http://zshwiki.org/home/examples/compquickstart
# If you want zsh's completion to pick up new commands in $path automatically
# comment out the next line and un-comment the following 5 lines
zstyle ':completion:::::' completer _complete _approximate
_force_rehash() {
  (( CURRENT == 1 )) && rehash
  return 1 # Because we didn't really complete anything
}
zstyle ':completion:::::' completer _force_rehash _complete _approximate

zstyle -e ':completion:*:approximate:*' max-errors 'reply=( $(( ($#PREFIX + $#SUFFIX) / 3 )) )'

## 'format' style
zstyle ':completion:*:descriptions'	format "- %d -"
zstyle ':completion:*:messages'		format "- %d -"
zstyle ':completion:*:corrections'	format "- %d - (errors %e})"
zstyle ':completion:*:warnings'		format "- no matches: %d -"

zstyle ':completion:*:default'		list-prompt '%S%M matches%s'

## group-name
## the empty string will make zsh use tag names for the group name
zstyle ':completion:*'			group-name ''

## sections
# man pages
zstyle ':completion:*:manuals'		separate-sections true
zstyle ':completion:*:manuals.(^1*)'	insert-sections   true
# dict entries
zstyle ':completion:*:words'		separate-sections true

## list-separator
zstyle ':completion:*' list-separator '#'

## Always use menu selection
## select=<N>
zstyle ':completion:*' menu select

zstyle ':completion:*' verbose yes

### $hosts completion
## /usr/share/doc/zsh/examples/ssh_completion.gz
## Including IP addresses
hosts=(${${${(f)"$(<$HOME/.ssh/known_hosts)"}%%\ *}%%,*})
## Excluding IP addresses
# hosts=(${${${${(f)"$(<$HOME/.ssh/known_hosts)"}:#[0-9]*}%%\ *}%%,*})
## For every command accepting hosts
zstyle ':completion:*:hosts' hosts $hosts
## Only for SSH
zstyle ':completion:*:complete:ssh:*:hosts' hosts $hosts

### http://ft.bewatermyfriend.org/
## Tolerate errors
zstyle -e ':completion:*:approximate:*'     max-errors 'reply=( $(( ($#PREFIX + $#SUFFIX) / 3 )) )'

## functions starting with '_' are completion functions by convention
## these are not supposed to be called by hand. no completion needed.
zstyle ':completion:*:(functions|parameters|association-keys)' \
                                                            ignored-patterns '_*'
## normally I don't want to complete *.o and *~, so, I'll ignore them
## update: these patterns are not ignored for rm, since i might want to delete those files
zstyle ':completion:*:*:(^rm):*:*files'                 ignored-patterns '*?.o' '*?\~'

## vi(m) can ignore even more files
zstyle ':completion:*:*:(^rm):*:*files'                 ignored-patterns '*?.o' '*?\~'

## vi(m) can ignore even more files
zstyle ':completion::*:(vi|vim):*'                      ignored-patterns '*?.(lo|so|la|o)'

## enable verbose completion; descriptions like: '-a  -- list entries starting with .'
zstyle ':completion:*'                                  verbose yes

## if i have 'rm file0' on the commandline
## i don't need "file0" in possible completions
zstyle ':completion:*:(rm|kill):*'                      ignore-line yes

## $hosts for <tab> completing hostnames
zstyle ':completion:*:(nc|ping|ssh|nmap|*ftp|telnet|finger):*' \
                                                            hosts $hosts

## i like kill <tab>, but i want more processes...
zstyle ':completion:*:processes'                        command 'ps --forest -A -o pid,user,cmd'
zstyle ':completion:*:*:kill:*:processes'               sort false
zstyle ':completion:*:processes-names'                  command 'ps c -u ${USER} -o command | uniq'

### Random stuff
zstyle ':completion:*' completer _expand _complete _correct _approximate
zstyle ':completion:*' list-colors ${(s.:.)LS_COLORS}

zstyle :compinstall filename '/home/redondos/.zshrc'

if [[ $HOSTNAME == refinery* ]]; then
    zstyle ':completion:*:urls' local aolivera.com.ar /var/www/aolivera.com.ar/htdocs
    zstyle ':completion:*:urls' local twat.com.ar ~/public_html
fi
## In case AUTO_CD is not enabled
# compctl -/ cd

## Aptitude 4.6 includes many aptitude-* commands that we don't want to be completed.
# zstyle ':completion:*:complete:-command-::commands'       ignored-patterns 'aptitude-*'
# zstyle ':completion:::::'                                 completer _complete _ignored _approximate

## Enable/disable globdots for completion
# _comp_options=(${_comp_options//*globdots/} noglobdots)
# _comp_options=(${_comp_options//*globdots/} globdots)

## kill
# http://madism.org/~madcoder/dotfiles/zsh/40_completion
zstyle ':completion:*:processes' command 'ps -au$USER -o pid,time,cmd|grep -v "ps -au$USER -o pid,time,cmd"'
zstyle ':completion:*:*:kill:*:processes' list-colors '=(#b) #([0-9]#)[ 0-9:]#([^ ]#)*=01;30=01;31=01;38'

# vim:ft=zsh
